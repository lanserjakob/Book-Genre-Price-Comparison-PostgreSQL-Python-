DROP TABLE IF EXISTS prices CASCADE;
DROP TABLE IF EXISTS products CASCADE;
DROP TABLE IF EXISTS genre CASCADE;
DROP TABLE IF EXISTS stores CASCADE;

CREATE TABLE genre (
    id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    name TEXT NOT NULL UNIQUE
);

CREATE TABLE stores (
    id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    name TEXT NOT NULL,
    location TEXT
);

CREATE TABLE products (
    id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    name TEXT NOT NULL,
    genre_id INT NOT NULL,
    unit TEXT,
    CONSTRAINT fk_genre FOREIGN KEY (genre_id)
        REFERENCES genre(id)
        ON DELETE CASCADE
);

CREATE TABLE prices (
    id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    product_id INT NOT NULL,
    store_id INT NOT NULL,
    date DATE NOT NULL,
    price_euro NUMERIC(10,2) NOT NULL,
    source TEXT,
    CONSTRAINT fk_product FOREIGN KEY (product_id)
        REFERENCES products(id)
        ON DELETE CASCADE,
    CONSTRAINT fk_store FOREIGN KEY (store_id)
        REFERENCES stores(id)
        ON DELETE CASCADE
);
